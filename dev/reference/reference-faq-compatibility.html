<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='vctrs provides a framework for working with vector classes in a generic
way. However, it implements several compatibility fallbacks to base R
methods. In this reference you will find how vctrs tries to be
compatible with your vector class, and what base methods you need to
implement for compatibility.
If you’re starting from scratch, we think you’ll find it easier to start
using new_vctr() as documented in
vignette("s3-vector"). This guide is aimed for developers with
existing vector classes.
Aggregate operations with fallbacks


All vctrs operations are based on four primitive generics described in
the next section. However there are many higher level operations. The
most important ones implement fallbacks to base generics for maximum
compatibility with existing classes.
vec_slice() falls back to the base [ generic if no
vec_proxy() method is implemented. This way foreign
classes that do not implement vec_restore() can
restore attributes based on the new subsetted contents.
vec_c() and vec_rbind() now fall back to
base::c() if the inputs have a common parent class with
a c() method (only if they have no self-to-self vec_ptype2()
method).
vctrs works hard to make your c() method success in various
situations (with NULL and NA inputs, even as first input which
would normally prevent dispatch to your method). The main downside
compared to using vctrs primitives is that you can’t combine vectors
of different classes since there is no extensible mechanism of
coercion in c(), and it is less efficient in some cases.





The vctrs primitives


Most functions in vctrs are aggregate operations: they call other vctrs
functions which themselves call other vctrs functions. The dependencies
of a vctrs functions are listed in the Dependencies section of its
documentation page. Take a look at vec_count() for an
example.
These dependencies form a tree whose leaves are the four vctrs
primitives. Here is the diagram for vec_count():

The coercion generics


The coercion mechanism in vctrs is based on two generics:
vec_ptype2()
vec_cast()


See the theory overview.
Two objects with the same class and the same attributes are always
considered compatible by ptype2 and cast. If the attributes or classes
differ, they throw an incompatible type error.
Coercion errors are the main source of incompatibility with vctrs. See
the howto guide if you need to implement methods
for these generics.



The proxy and restoration generics


vec_proxy()
vec_restore()


These generics are essential for vctrs but mostly optional.
vec_proxy() defaults to an identity function and you
normally don’t need to implement it. The proxy a vector must be one of
the atomic vector types, a list, or a data frame. By default, S3 lists
that do not inherit from "list" do not have an identity proxy. In that
case, you need to explicitly implement vec_proxy() or make your class
inherit from list.




'><title>FAQ - Is my class compatible with vctrs? — reference-faq-compatibility • vctrs</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.5/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.5/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="FAQ - Is my class compatible with vctrs? — reference-faq-compatibility"><meta property="og:description" content='vctrs provides a framework for working with vector classes in a generic
way. However, it implements several compatibility fallbacks to base R
methods. In this reference you will find how vctrs tries to be
compatible with your vector class, and what base methods you need to
implement for compatibility.
If you’re starting from scratch, we think you’ll find it easier to start
using new_vctr() as documented in
vignette("s3-vector"). This guide is aimed for developers with
existing vector classes.
Aggregate operations with fallbacks


All vctrs operations are based on four primitive generics described in
the next section. However there are many higher level operations. The
most important ones implement fallbacks to base generics for maximum
compatibility with existing classes.
vec_slice() falls back to the base [ generic if no
vec_proxy() method is implemented. This way foreign
classes that do not implement vec_restore() can
restore attributes based on the new subsetted contents.
vec_c() and vec_rbind() now fall back to
base::c() if the inputs have a common parent class with
a c() method (only if they have no self-to-self vec_ptype2()
method).
vctrs works hard to make your c() method success in various
situations (with NULL and NA inputs, even as first input which
would normally prevent dispatch to your method). The main downside
compared to using vctrs primitives is that you can’t combine vectors
of different classes since there is no extensible mechanism of
coercion in c(), and it is less efficient in some cases.





The vctrs primitives


Most functions in vctrs are aggregate operations: they call other vctrs
functions which themselves call other vctrs functions. The dependencies
of a vctrs functions are listed in the Dependencies section of its
documentation page. Take a look at vec_count() for an
example.
These dependencies form a tree whose leaves are the four vctrs
primitives. Here is the diagram for vec_count():

The coercion generics


The coercion mechanism in vctrs is based on two generics:
vec_ptype2()
vec_cast()


See the theory overview.
Two objects with the same class and the same attributes are always
considered compatible by ptype2 and cast. If the attributes or classes
differ, they throw an incompatible type error.
Coercion errors are the main source of incompatibility with vctrs. See
the howto guide if you need to implement methods
for these generics.



The proxy and restoration generics


vec_proxy()
vec_restore()


These generics are essential for vctrs but mostly optional.
vec_proxy() defaults to an identity function and you
normally don’t need to implement it. The proxy a vector must be one of
the atomic vector types, a list, or a data frame. By default, S3 lists
that do not inherit from "list" do not have an identity proxy. In that
case, you need to explicitly implement vec_proxy() or make your class
inherit from list.




'><meta property="og:image" content="https://vctrs.r-lib.org/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="vctrs.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">vctrs</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.6.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pillar.html">Printing vectors nicely in tibbles</a>
    <a class="dropdown-item" href="../articles/s3-vector.html">S3 vectors</a>
    <a class="dropdown-item" href="../articles/stability.html">Type and size stability</a>
    <a class="dropdown-item" href="../articles/type-size.html">Prototypes and sizes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/vctrs/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>FAQ - Is my class compatible with vctrs?</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/vctrs/blob/HEAD/R/faq-developer.R" class="external-link"><code>R/faq-developer.R</code></a></small>
      <div class="d-none name"><code>reference-faq-compatibility.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>vctrs provides a framework for working with vector classes in a generic
way. However, it implements several compatibility fallbacks to base R
methods. In this reference you will find how vctrs tries to be
compatible with your vector class, and what base methods you need to
implement for compatibility.</p>
<p>If you’re starting from scratch, we think you’ll find it easier to start
using <code><a href="new_vctr.html">new_vctr()</a></code> as documented in
<code><a href="../articles/s3-vector.html">vignette("s3-vector")</a></code>. This guide is aimed for developers with
existing vector classes.</p><div class="section">
<h3 id="aggregate-operations-with-fallbacks">Aggregate operations with fallbacks<a class="anchor" aria-label="anchor" href="#aggregate-operations-with-fallbacks"></a></h3>


<p>All vctrs operations are based on four primitive generics described in
the next section. However there are many higher level operations. The
most important ones implement fallbacks to base generics for maximum
compatibility with existing classes.</p><ul><li><p><code><a href="vec_slice.html">vec_slice()</a></code> falls back to the base <code>[</code> generic if no
<code><a href="vec_proxy.html">vec_proxy()</a></code> method is implemented. This way foreign
classes that do not implement <code><a href="vec_proxy.html">vec_restore()</a></code> can
restore attributes based on the new subsetted contents.</p></li>
<li><p><code><a href="vec_c.html">vec_c()</a></code> and <code><a href="vec_bind.html">vec_rbind()</a></code> now fall back to
<code><a href="https://rdrr.io/r/base/c.html" class="external-link">base::c()</a></code> if the inputs have a common parent class with
a <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> method (only if they have no self-to-self <code><a href="vec_ptype2.html">vec_ptype2()</a></code>
method).</p>
<p>vctrs works hard to make your <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> method success in various
situations (with <code>NULL</code> and <code>NA</code> inputs, even as first input which
would normally prevent dispatch to your method). The main downside
compared to using vctrs primitives is that you can’t combine vectors
of different classes since there is no extensible mechanism of
coercion in <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>, and it is less efficient in some cases.</p></li>
</ul></div>

<div class="section">
<h3 id="the-vctrs-primitives">The vctrs primitives<a class="anchor" aria-label="anchor" href="#the-vctrs-primitives"></a></h3>


<p>Most functions in vctrs are aggregate operations: they call other vctrs
functions which themselves call other vctrs functions. The dependencies
of a vctrs functions are listed in the Dependencies section of its
documentation page. Take a look at <code><a href="vec_count.html">vec_count()</a></code> for an
example.</p>
<p>These dependencies form a tree whose leaves are the four vctrs
primitives. Here is the diagram for <code><a href="vec_count.html">vec_count()</a></code>:</p>
<p><img src="figures/vec-count-deps.png" alt=""></p><div class="section">
<h4 id="the-coercion-generics">The coercion generics<a class="anchor" aria-label="anchor" href="#the-coercion-generics"></a></h4>


<p>The coercion mechanism in vctrs is based on two generics:</p><ul><li><p><code><a href="vec_ptype2.html">vec_ptype2()</a></code></p></li>
<li><p><code><a href="vec_cast.html">vec_cast()</a></code></p></li>
</ul><p>See the <a href="theory-faq-coercion.html">theory overview</a>.</p>
<p>Two objects with the same class and the same attributes are always
considered compatible by ptype2 and cast. If the attributes or classes
differ, they throw an incompatible type error.</p>
<p>Coercion errors are the main source of incompatibility with vctrs. See
the <a href="howto-faq-coercion.html">howto guide</a> if you need to implement methods
for these generics.</p>
</div>

<div class="section">
<h4 id="the-proxy-and-restoration-generics">The proxy and restoration generics<a class="anchor" aria-label="anchor" href="#the-proxy-and-restoration-generics"></a></h4>

<ul><li><p><code><a href="vec_proxy.html">vec_proxy()</a></code></p></li>
<li><p><code><a href="vec_proxy.html">vec_restore()</a></code></p></li>
</ul><p>These generics are essential for vctrs but mostly optional.
<code><a href="vec_proxy.html">vec_proxy()</a></code> defaults to an <a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a> function and you
normally don’t need to implement it. The proxy a vector must be one of
the atomic vector types, a list, or a data frame. By default, S3 lists
that do not inherit from <code>"list"</code> do not have an identity proxy. In that
case, you need to explicitly implement <code><a href="vec_proxy.html">vec_proxy()</a></code> or make your class
inherit from list.</p>
</div>


</div>

    </div>



  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

