<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Changelog • vctrs</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Changelog" />
<meta property="og:image" content="https://vctrs.r-lib.org/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-news">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vctrs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/pillar.html">Printing vectors nicely in tibbles</a>
    </li>
    <li>
      <a href="../articles/s3-vector.html">S3 vectors</a>
    </li>
    <li>
      <a href="../articles/stability.html">Type and size stability</a>
    </li>
    <li>
      <a href="../articles/type-size.html">Prototypes and sizes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/vctrs/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
      <h1 data-toc-skip>Changelog <small></small></h1>
      <small>Source: <a href='https://github.com/r-lib/vctrs/blob/master/NEWS.md'><code>NEWS.md</code></a></small>
    </div>

    <div id="vctrs-development-version" class="section level1">
<h1 class="page-header" data-toc-text="development version">
<a href="#vctrs-development-version" class="anchor"></a>vctrs (development version)<small> Unreleased </small>
</h1>
<ul>
<li><p>The restriction that S3 lists must have a list-based proxy to be considered lists by <code><a href="../reference/vec_is_list.html">vec_is_list()</a></code> has been removed (<a href='https://github.com/r-lib/vctrs/issues/1208'>#1208</a>).</p></li>
<li><p>New performant <code><a href="../reference/data_frame.html">data_frame()</a></code> constructor for creating data frames in a way that follows tidyverse semantics. Among other things, inputs are recycled using tidyverse recycling rules, strings are never converted to factors, list-columns are easier to create, and unnamed data frame input is automatically spliced.</p></li>
<li><p>New <code><a href="../reference/df_list.html">df_list()</a></code> for safely and consistently constructing the data structure underlying a data frame, a named list of equal-length vectors. It is useful in combination with <code><a href="../reference/new_data_frame.html">new_data_frame()</a></code> for creating user-friendly constructors for data frame subclasses that use the tidyverse rules for recycling and determining types.</p></li>
<li><p>Fixed performance issue with <code><a href="../reference/vec_order.html">vec_order()</a></code> on classed vectors which affected <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">dplyr::group_by()</a></code> (tidyverse/dplyr<a href='https://github.com/r-lib/vctrs/issues/5423'>#5423</a>).</p></li>
<li><p><code><a href="../reference/vec_names.html">vec_set_names()</a></code> no longer alters the input in-place (<a href='https://github.com/r-lib/vctrs/issues/1194'>#1194</a>).</p></li>
<li><p>New <code><a href="../reference/vec_proxy_compare.html">vec_proxy_order()</a></code> that provides an ordering proxy for use in <code><a href="../reference/vec_order.html">vec_order()</a></code> and <code><a href="../reference/vec_order.html">vec_sort()</a></code>. The default method falls through to <code><a href="../reference/vec_proxy_compare.html">vec_proxy_compare()</a></code>. Lists are special cased, and return an integer vector proxy that orders by first appearance.</p></li>
<li><p>List columns in data frames are no longer comparable through <code><a href="../reference/vec_compare.html">vec_compare()</a></code>.</p></li>
<li><p>The experimental <code>relax</code> argument has been removed from <code><a href="../reference/vec_proxy_compare.html">vec_proxy_compare()</a></code>.</p></li>
</ul>
</div>
    <div id="vctrs-032" class="section level1">
<h1 class="page-header" data-toc-text="0.3.2">
<a href="#vctrs-032" class="anchor"></a>vctrs 0.3.2<small> 2020-07-15 </small>
</h1>
<ul>
<li>
<p>Fixed a performance issue in <code>bind_rows()</code> with S3 columns (<a href='https://github.com/r-lib/vctrs/issues/1122'>#1122</a>,</p>
<p><a href='https://github.com/r-lib/vctrs/issues/1124'>#1124</a>, <a href='https://github.com/r-lib/vctrs/issues/1151'>#1151</a>, tidyverse/dplyr<a href='https://github.com/r-lib/vctrs/issues/5327'>#5327</a>).</p>
</li>
<li><p><code><a href="../reference/vec_slice.html">vec_slice()</a></code> now checks sizes of data frame columns in case the data structure is corrupt (<a href='https://github.com/r-lib/vctrs/issues/552'>#552</a>).</p></li>
<li><p>The native routines in vctrs now dispatch and evaluate in the vctrs namespace. This improves the continuity of evaluation in backtraces.</p></li>
<li><p><code><a href="../reference/new_data_frame.html">new_data_frame()</a></code> is now twice as fast when <code>class</code> is supplied.</p></li>
<li><p>New <code><a href="../reference/vec_names.html">vec_names2()</a></code>, <code><a href="../reference/vec_names.html">vec_names()</a></code> and <code><a href="../reference/vec_names.html">vec_set_names()</a></code> (<a href='https://github.com/r-lib/vctrs/issues/1173'>#1173</a>).</p></li>
</ul>
</div>
    <div id="vctrs-031" class="section level1">
<h1 class="page-header" data-toc-text="0.3.1">
<a href="#vctrs-031" class="anchor"></a>vctrs 0.3.1<small> 2020-06-05 </small>
</h1>
<ul>
<li><p><code><a href="../reference/vec_slice.html">vec_slice()</a></code> no longer restores attributes of foreign objects for which a <code><a href="https://rdrr.io/r/base/Extract.html">[</a></code> method exist. This fixes an issue with <code>ts</code> objects which were previously incorrectly restored.</p></li>
<li><p>The <code><a href="https://rdrr.io/r/base/list.html">as.list()</a></code> method for <code>vctrs_rcrd</code> objects has been removed in favor of directly using the method for <code>vctrs_vctr</code>, which calls <code><a href="../reference/vec_chop.html">vec_chop()</a></code>.</p></li>
<li><p><code><a href="../reference/vec_c.html">vec_c()</a></code> and <code><a href="../reference/vec_bind.html">vec_rbind()</a></code> now fall back to <code><a href="https://rdrr.io/r/base/c.html">base::c()</a></code> if the inputs have a common class hierarchy for which a <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> method is implemented but no self-to-self <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> method is implemented.</p></li>
<li><p><code><a href="../reference/vec_bind.html">vec_rbind()</a></code> now internally calls <code><a href="../reference/vec_proxy.html">vec_proxy()</a></code> and <code><a href="../reference/vec_proxy.html">vec_restore()</a></code> on the data frame common type that is used to create the output (<a href='https://github.com/r-lib/vctrs/issues/1109'>#1109</a>).</p></li>
<li><p><code><a href="../reference/vec_as_location.html">vec_as_location2("0")</a></code> now works correctly (<a href='https://github.com/r-lib/vctrs/issues/1131'>#1131</a>).</p></li>
<li><p><code>?reference-faq-compatibility</code> is a new reference guide on vctrs primitives. It includes an overview of the fallbacks to base R generics implemented in vctrs for compatibility with existing classes.</p></li>
<li><p>The documentation of vctrs functions now includes a Dependencies section to reference which other vctrs operations are called from that function. By following the dependencies links recursively, you will find the vctrs primitives on which an operation relies.</p></li>
</ul>
<div id="cran-results" class="section level2">
<h2 class="hasAnchor">
<a href="#cran-results" class="anchor"></a>CRAN results</h2>
<ul>
<li>Fixed type declaration mismatches revealed by LTO build.</li>
<li>Fixed r-devel issue with new <code>c.factor()</code> method.</li>
</ul>
</div>
</div>
    <div id="vctrs-030" class="section level1">
<h1 class="page-header" data-toc-text="0.3.0">
<a href="#vctrs-030" class="anchor"></a>vctrs 0.3.0<small> 2020-05-11 </small>
</h1>
<p>This version features an overhaul of the coercion system to make it more consistent and easier to implement. See the <em>Breaking changes</em> and <em>Type system</em> sections for details.</p>
<p>There are three new documentation topics if you’d like to learn how to implement coercion methods to make your class compatible with tidyverse packages like dplyr:</p>
<ul>
<li><p><a href="https://vctrs.r-lib.org/reference/theory-faq-coercion.html" class="uri">https://vctrs.r-lib.org/reference/theory-faq-coercion.html</a> for an overview of the coercion mechanism in vctrs.</p></li>
<li><p><a href="https://vctrs.r-lib.org/reference/howto-faq-coercion.html" class="uri">https://vctrs.r-lib.org/reference/howto-faq-coercion.html</a> for a practical guide about implementing methods for vectors.</p></li>
<li><p><a href="https://vctrs.r-lib.org/reference/howto-faq-coercion-data-frame.html" class="uri">https://vctrs.r-lib.org/reference/howto-faq-coercion-data-frame.html</a> for a practical guide about implementing methods for data frames.</p></li>
</ul>
<div id="reverse-dependencies-troubleshooting" class="section level2">
<h2 class="hasAnchor">
<a href="#reverse-dependencies-troubleshooting" class="anchor"></a>Reverse dependencies troubleshooting</h2>
<p>The following errors are caused by breaking changes.</p>
<ul>
<li>
<p><code>"Can't convert &lt;character&gt; to &lt;list&gt;."</code></p>
<p><code><a href="../reference/vec_cast.html">vec_cast()</a></code> no longer converts to list. Use <code><a href="../reference/vec_chop.html">vec_chop()</a></code> or <code><a href="https://rdrr.io/r/base/list.html">as.list()</a></code> instead.</p>
</li>
<li>
<p><code>"Can't convert &lt;integer&gt; to &lt;character&gt;."</code></p>
<p><code><a href="../reference/vec_cast.html">vec_cast()</a></code> no longer converts to character. Use <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code>to deparse objects.</p>
</li>
<li>
<p><code>"names for target but not for current"</code></p>
<p>Names of list-columns are now preserved by <code><a href="../reference/vec_bind.html">vec_rbind()</a></code>. Adjust tests accordingly.</p>
</li>
</ul>
</div>
<div id="breaking-changes" class="section level2">
<h2 class="hasAnchor">
<a href="#breaking-changes" class="anchor"></a>Breaking changes</h2>
<ul>
<li>
<p>Double-dispatch methods for <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> and <code><a href="../reference/vec_cast.html">vec_cast()</a></code> are no longer inherited (<a href='https://github.com/r-lib/vctrs/issues/710'>#710</a>). Class implementers must implement one set of methods for each compatible class.</p>
<p>For example, a tibble subclass no longer inherits from the <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> methods between <code>tbl_df</code> and <code>data.frame</code>. This means that you explicitly need to implement <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> methods with <code>tbl_df</code> and <code>data.frame</code>.</p>
<p>This change requires a bit more work from class maintainers but is safer because the coercion hierarchies are generally different from class hierarchies. See the S3 dispatch section of <code><a href="../reference/vec_ptype2.logical.html">?vec_ptype2</a></code> for more information.</p>
</li>
<li>
<p><code><a href="../reference/vec_cast.html">vec_cast()</a></code> is now restricted to the same conversions as <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> methods (<a href='https://github.com/r-lib/vctrs/issues/606'>#606</a>, <a href='https://github.com/r-lib/vctrs/issues/741'>#741</a>). This change is motivated by safety and performance:</p>
<ul>
<li><p>It is generally sloppy to generically convert arbitrary inputs to one type. Restricted coercions are more predictable and allow your code to fail earlier when there is a type issue.</p></li>
<li><p>When unrestricted conversions are useful, this is generally towards a known type. For example, <code><a href="https://glue.tidyverse.org/reference/glue.html">glue::glue()</a></code> needs to convert arbitrary inputs to the known character type. In this case, using double dispatch instead of a single dispatch generic like <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> is wasteful.</p></li>
<li><p>To implement the useful semantics of coercible casts (already used in <code><a href="../reference/vec_slice.html">vec_assign()</a></code>), two double dispatch were needed. Now it can be done with one double dispatch by calling <code><a href="../reference/vec_cast.html">vec_cast()</a></code> directly.</p></li>
</ul>
</li>
<li><p><code><a href="../reference/vctrs-conditions.html">stop_incompatible_cast()</a></code> now throws an error of class <code>vctrs_error_incompatible_type</code> rather than <code>vctrs_error_incompatible_cast</code>. This means that <code><a href="../reference/vec_cast.html">vec_cast()</a></code> also throws errors of this class, which better aligns it with <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> now that they are restricted to the same conversions.</p></li>
<li><p>The <code>y</code> argument of <code><a href="../reference/vctrs-conditions.html">stop_incompatible_cast()</a></code> has been renamed to <code>to</code> to better match <code>to_arg</code>.</p></li>
</ul>
</div>
<div id="type-system" class="section level2">
<h2 class="hasAnchor">
<a href="#type-system" class="anchor"></a>Type system</h2>
<ul>
<li>
<p>Double-dispatch methods for <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> and <code><a href="../reference/vec_cast.html">vec_cast()</a></code> are now easier to implement. They no longer need any the boiler plate. Implementing a method for classes <code>foo</code> and <code>bar</code> is now as simple as:</p>
<pre><code>#' <a href='https://github.com/export'>@export</a>
vec_ptype2.foo.bar &lt;- function(x, y, ...) new_foo()</code></pre>
<p>vctrs also takes care of implementing the default and unspecified methods. If you have implemented these methods, they are no longer called and can now be removed.</p>
<p>One consequence of the new dispatch mechanism is that <code><a href="https://rdrr.io/r/base/UseMethod.html">NextMethod()</a></code> is now completely unsupported. This is for the best as it never worked correctly in a double-dispatch setting. Parent methods must now be called manually.</p>
</li>
<li><p><code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> methods now get zero-size prototypes as inputs. This guarantees that methods do not peek at the data to determine the richer type.</p></li>
<li><p><code><a href="../reference/vec_is_list.html">vec_is_list()</a></code> no longer allows S3 lists that implement a <code><a href="../reference/vec_proxy.html">vec_proxy()</a></code> method to automatically be considered lists. A S3 list must explicitly inherit from <code>"list"</code> in the base class to be considered a list.</p></li>
<li><p><code><a href="../reference/vec_proxy.html">vec_restore()</a></code> no longer restores row names if the target is not a data frame. This fixes an issue where <code>POSIXlt</code> objects would carry a <code>row.names</code> attribute after a proxy/restore roundtrip.</p></li>
<li><p><code><a href="../reference/vec_cast.html">vec_cast()</a></code> to and from data frames preserves the row names of inputs.</p></li>
<li>
<p>The internal function <code><a href="../reference/vec_names.html">vec_names()</a></code> now returns row names if the input is a data frame. Similarly, <code><a href="../reference/vec_names.html">vec_set_names()</a></code> sets row names on data frames. This is part of a general effort at making row names the vector names of data frames in vctrs.</p>
<p>If necessary, the row names are repaired verbosely but without error to make them unique. This should be a mostly harmless change for users, but it could break unit tests in packages if they make assumptions about the row names.</p>
</li>
</ul>
</div>
<div id="compatibility-and-fallbacks" class="section level2">
<h2 class="hasAnchor">
<a href="#compatibility-and-fallbacks" class="anchor"></a>Compatibility and fallbacks</h2>
<ul>
<li>
<p>With the double dispatch changes, the coercion methods are no longer inherited from parent classes. This is because the coercion hierarchy is in principle different from the S3 hierarchy. A consequence of this change is that subclasses that don’t implement coercion methods are now in principle incompatible.</p>
<p>This is particularly problematic with subclasses of data frames for which throwing incompatible errors would be too incovenient for users. To work around this, we have implemented a fallback to the relevant base data frame class (either <code>data.frame</code> or <code>tbl_df</code>) in coercion methods (<a href='https://github.com/r-lib/vctrs/issues/981'>#981</a>). This fallback is silent unless you set the <code>vctrs:::warn_on_fallback</code> option to <code>TRUE</code>.</p>
<p>In the future we may extend this fallback principle to other base types when they are explicitly included in the class vector (such as <code>"list"</code>).</p>
</li>
<li>
<p>Improved support for foreign classes in the combining operations <code><a href="../reference/vec_c.html">vec_c()</a></code>, <code><a href="../reference/vec_bind.html">vec_rbind()</a></code>, and <code><a href="../reference/vec_chop.html">vec_unchop()</a></code>. A foreign class is a class that doesn’t implement <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code>. When all the objects to combine have the same foreign class, one of these fallbacks is invoked:</p>
<ul>
<li><p>If the class implements a <code><a href="https://rdrr.io/r/base/c.html">base::c()</a></code> method, the method is used for the combination. (FIXME: <code><a href="../reference/vec_bind.html">vec_rbind()</a></code> currently doesn’t use this fallback.)</p></li>
<li><p>Otherwise if the objects have identical attributes and the same base type, we consider them to be compatible. The vectors are concatenated and the attributes are restored (<a href='https://github.com/r-lib/vctrs/issues/776'>#776</a>).</p></li>
</ul>
<p>These fallbacks do not make your class completely compatible with vctrs-powered packages, but they should help in many simple cases.</p>
</li>
<li><p><code><a href="../reference/vec_c.html">vec_c()</a></code> and <code><a href="../reference/vec_chop.html">vec_unchop()</a></code> now fall back to <code><a href="https://rdrr.io/r/base/c.html">base::c()</a></code> for S4 objects if the object doesn’t implement <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> but sets an S4 <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> method (<a href='https://github.com/r-lib/vctrs/issues/919'>#919</a>).</p></li>
</ul>
</div>
<div id="vector-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#vector-operations" class="anchor"></a>Vector operations</h2>
<ul>
<li><p><code><a href="../reference/vec_bind.html">vec_rbind()</a></code> and <code><a href="../reference/vec_c.html">vec_c()</a></code> with data frame inputs now consistently preserve the names of list-columns, df-columns, and matrix-columns (<a href='https://github.com/r-lib/vctrs/issues/689'>#689</a>). This can cause some false positives in unit tests, if they are sensitive to internal names (<a href='https://github.com/r-lib/vctrs/issues/1007'>#1007</a>).</p></li>
<li><p><code><a href="../reference/vec_bind.html">vec_rbind()</a></code> now repairs row names silently to avoid confusing messages when the row names are not informative and were not created on purpose.</p></li>
<li><p><code><a href="../reference/vec_bind.html">vec_rbind()</a></code> gains option to treat input names as row names. This is disabled by default (<a href='https://github.com/r-lib/vctrs/issues/966'>#966</a>).</p></li>
<li><p>New <code><a href="../reference/vec-rep.html">vec_rep()</a></code> and <code><a href="../reference/vec-rep.html">vec_rep_each()</a></code> for repeating an entire vector and elements of a vector, respectively. These two functions provide a clearer interface for the functionality of <code><a href="../reference/vec_repeat.html">vec_repeat()</a></code>, which is now deprecated.</p></li>
<li>
<p><code><a href="../reference/vec_bind.html">vec_cbind()</a></code> now calls <code><a href="../reference/vec_proxy.html">vec_restore()</a></code> on inputs emptied of their columns before computing the common type. This has consequences for data frame classes with special columns that devolve into simpler classes when the columns are subsetted out. These classes are now always simplified by <code><a href="../reference/vec_bind.html">vec_cbind()</a></code>.</p>
<p>For instance, column-binding a grouped data frame with a data frame now produces a tibble (the simplified class of a grouped data frame).</p>
</li>
<li><p><code><a href="../reference/vec_match.html">vec_match()</a></code> and <code><a href="../reference/vec_match.html">vec_in()</a></code> gain parameters for argument tags (<a href='https://github.com/r-lib/vctrs/issues/944'>#944</a>).</p></li>
<li><p>The internal version of <code><a href="../reference/vec_slice.html">vec_assign()</a></code> now has support for assigning names and inner names. For data frames, the names are assigned recursively.</p></li>
<li><p><code><a href="../reference/vec_slice.html">vec_assign()</a></code> gains <code>x_arg</code> and <code>value_arg</code> parameters (<a href='https://github.com/r-lib/vctrs/issues/918'>#918</a>).</p></li>
<li><p><code><a href="../reference/vec_group.html">vec_group_loc()</a></code>, which powers <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">dplyr::group_by()</a></code>, now has more efficient vector access (<a href='https://github.com/r-lib/vctrs/issues/911'>#911</a>).</p></li>
<li><p><code><a href="../reference/vec_ptype.html">vec_ptype()</a></code> gained an <code>x_arg</code> argument.</p></li>
<li><p>New <code><a href="../reference/vec_size.html">list_sizes()</a></code> for computing the size of every element in a list. <code><a href="../reference/vec_size.html">list_sizes()</a></code> is to <code><a href="../reference/vec_size.html">vec_size()</a></code> as <code><a href="https://rdrr.io/r/base/lengths.html">lengths()</a></code> is to <code><a href="https://rdrr.io/r/base/length.html">length()</a></code>, except that it only supports lists. Atomic vectors and data frames result in an error.</p></li>
<li><p><code><a href="../reference/new_data_frame.html">new_data_frame()</a></code> infers size from row names when <code>n = NULL</code> (<a href='https://github.com/r-lib/vctrs/issues/894'>#894</a>).</p></li>
<li><p><code><a href="../reference/vec_c.html">vec_c()</a></code> now accepts <code><a href="https://rlang.r-lib.org/reference/zap.html">rlang::zap()</a></code> as <code>.name_spec</code> input. The returned vector is then always unnamed, and the names do not cause errors when they can’t be combined. They are still used to create more informative messages when the inputs have incompatible types (<a href='https://github.com/r-lib/vctrs/issues/232'>#232</a>).</p></li>
</ul>
</div>
<div id="classes" class="section level2">
<h2 class="hasAnchor">
<a href="#classes" class="anchor"></a>Classes</h2>
<ul>
<li><p>vctrs now supports the <code>data.table</code> class. The common type of a data frame and a data table is a data table.</p></li>
<li><p><code><a href="../reference/new_vctr.html">new_vctr()</a></code> now always appends a base <code>"list"</code> class to list <code>.data</code> to be compatible with changes to <code><a href="../reference/vec_is_list.html">vec_is_list()</a></code>. This affects <code><a href="../reference/new_list_of.html">new_list_of()</a></code>, which now returns an object with a base class of <code>"list"</code>.</p></li>
<li><p>dplyr methods are now implemented for <code><a href="../reference/vec_proxy.html">vec_restore()</a></code>, <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code>, and <code><a href="../reference/vec_cast.html">vec_cast()</a></code>. The user-visible consequence (and breaking change) is that row-binding a grouped data frame and a data frame or tibble now returns a grouped data frame. It would previously return a tibble.</p></li>
<li><p>The <code>is.na&lt;-()</code> method for <code>vctrs_vctr</code> now supports numeric and character subscripts to indicate where to insert missing values (<a href='https://github.com/r-lib/vctrs/issues/947'>#947</a>).</p></li>
<li><p>Improved support for vector-like S4 objects (<a href='https://github.com/r-lib/vctrs/issues/550'>#550</a>, <a href='https://github.com/r-lib/vctrs/issues/551'>#551</a>).</p></li>
<li><p>The base classes <code>AsIs</code> and <code>table</code> have vctrs methods (<a href='https://github.com/r-lib/vctrs/issues/904'>#904</a>, <a href='https://github.com/r-lib/vctrs/issues/906'>#906</a>).</p></li>
<li><p><code>POSIXlt</code> and <code>POSIXct</code> vectors are handled more consistently (<a href='https://github.com/r-lib/vctrs/issues/901'>#901</a>).</p></li>
<li><p>Ordered factors that do not have identical levels are now incompatible. They are now incompatible with all factors.</p></li>
</ul>
</div>
<div id="indexing-and-names" class="section level2">
<h2 class="hasAnchor">
<a href="#indexing-and-names" class="anchor"></a>Indexing and names</h2>
<ul>
<li><p><code><a href="../reference/vec_as_subscript.html">vec_as_subscript()</a></code> now fails when the subscript is a matrix or an array, consistently with <code><a href="../reference/vec_as_location.html">vec_as_location()</a></code>.</p></li>
<li><p>Improved error messages in <code><a href="../reference/vec_as_location.html">vec_as_location()</a></code> when subscript is a matrix or array (<a href='https://github.com/r-lib/vctrs/issues/936'>#936</a>).</p></li>
<li><p><code><a href="../reference/vec_as_location.html">vec_as_location2()</a></code> properly picks up <code>subscript_arg</code> (tidyverse/tibble<a href='https://github.com/r-lib/vctrs/issues/735'>#735</a>).</p></li>
<li><p><code><a href="../reference/vec_as_names.html">vec_as_names()</a></code> now has more informative error messages when names are not unique (<a href='https://github.com/r-lib/vctrs/issues/882'>#882</a>).</p></li>
<li><p><code><a href="../reference/vec_as_names.html">vec_as_names()</a></code> gains a <code>repair_arg</code> argument that when set will cause <code>repair = "check_unique"</code> to generate an informative hint (<a href='https://github.com/r-lib/vctrs/issues/692'>#692</a>).</p></li>
</ul>
</div>
<div id="conditions" class="section level2">
<h2 class="hasAnchor">
<a href="#conditions" class="anchor"></a>Conditions</h2>
<ul>
<li><p><code><a href="../reference/vctrs-conditions.html">stop_incompatible_type()</a></code> now has an <code>action</code> argument for customizing whether the coercion error came from <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> or <code><a href="../reference/vec_cast.html">vec_cast()</a></code>. <code><a href="../reference/vctrs-conditions.html">stop_incompatible_cast()</a></code> is now a thin wrapper around <code><a href="../reference/vctrs-conditions.html">stop_incompatible_type(action = "convert")</a></code>.</p></li>
<li><p><code>stop_</code> functions now take <code>details</code> after the dots. This argument can no longer be passed by position.</p></li>
<li><p>Supplying both <code>details</code> and <code>message</code> to the <code>stop_</code> functions is now an internal error.</p></li>
<li><p><code>x_arg</code>, <code>y_arg</code>, and <code>to_arg</code> are now compulsory arguments in <code>stop_</code> functions like <code><a href="../reference/vctrs-conditions.html">stop_incompatible_type()</a></code>.</p></li>
<li><p>Lossy cast errors are now considered internal. Please don’t test for the class or explicitly handle them.</p></li>
<li><p>New argument <code>loss_type</code> for the experimental function <code><a href="../reference/maybe_lossy_cast.html">maybe_lossy_cast()</a></code>. It can take the values “precision” or “generality” to indicate in the error message which kind of loss is the error about (double to integer loses precision, character to factor loses generality).</p></li>
<li><p>Coercion and recycling errors are now more consistent.</p></li>
</ul>
</div>
<div id="cran-results-1" class="section level2">
<h2 class="hasAnchor">
<a href="#cran-results-1" class="anchor"></a>CRAN results</h2>
<ul>
<li><p>Fixed clang-UBSAN error “nan is outside the range of representable values of type ‘int’” (<a href='https://github.com/r-lib/vctrs/issues/902'>#902</a>).</p></li>
<li><p>Fixed compilation of stability vignette following the date conversion changes on R-devel.</p></li>
</ul>
</div>
</div>
    <div id="vctrs-024" class="section level1">
<h1 class="page-header" data-toc-text="0.2.4">
<a href="#vctrs-024" class="anchor"></a>vctrs 0.2.4<small> 2020-03-10 </small>
</h1>
<ul>
<li><p>Factors and dates methods are now implemented in C for efficiency.</p></li>
<li><p><code><a href="../reference/new_data_frame.html">new_data_frame()</a></code> now correctly updates attributes and supports merging of the <code>"names"</code> and <code>"row.names"</code> arguments (<a href='https://github.com/r-lib/vctrs/issues/883'>#883</a>).</p></li>
<li><p><code><a href="../reference/vec_match.html">vec_match()</a></code> gains an <code>na_equal</code> argument (<a href='https://github.com/r-lib/vctrs/issues/718'>#718</a>).</p></li>
<li><p><code><a href="../reference/vec_chop.html">vec_chop()</a></code>’s <code>indices</code> argument has been restricted to positive integer vectors. Character and logical subscripts haven’t proven useful, and this aligns <code><a href="../reference/vec_chop.html">vec_chop()</a></code> with <code><a href="../reference/vec_chop.html">vec_unchop()</a></code>, for which only positive integer vectors make sense.</p></li>
<li><p>New <code><a href="../reference/vec_chop.html">vec_unchop()</a></code> for combining a list of vectors into a single vector. It is similar to <code><a href="../reference/vec_c.html">vec_c()</a></code>, but gives greater control over how the elements are placed in the output through the use of a secondary <code>indices</code> argument.</p></li>
<li><p>Breaking change: When <code>.id</code> is supplied, <code><a href="../reference/vec_bind.html">vec_rbind()</a></code> now creates the identifier column at the start of the data frame rather than at the end.</p></li>
<li><p><code>numeric_version</code> and <code>package_version</code> lists are now treated as vectors (<a href='https://github.com/r-lib/vctrs/issues/723'>#723</a>).</p></li>
<li><p><code><a href="../reference/vec_slice.html">vec_slice()</a></code> now properly handles symbols and S3 subscripts.</p></li>
<li><p><code><a href="../reference/vec_as_location.html">vec_as_location()</a></code> and <code><a href="../reference/vec_as_subscript.html">vec_as_subscript()</a></code> are now fully implemented in C for efficiency.</p></li>
<li><p><code><a href="../reference/vec_as_location.html">num_as_location()</a></code> gains a new argument, <code>zero</code>, for controlling whether to <code>"remove"</code>, <code>"ignore"</code>, or <code>"error"</code> on zero values (<a href='https://github.com/r-lib/vctrs/issues/852'>#852</a>).</p></li>
</ul>
</div>
    <div id="vctrs-023" class="section level1">
<h1 class="page-header" data-toc-text="0.2.3">
<a href="#vctrs-023" class="anchor"></a>vctrs 0.2.3<small> 2020-02-20 </small>
</h1>
<ul>
<li><p>The main feature of this release is considerable performance improvements with factors and dates.</p></li>
<li><p><code><a href="../reference/vec_c.html">vec_c()</a></code> now falls back to <code><a href="https://rdrr.io/r/base/c.html">base::c()</a></code> if the vector doesn’t implement <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> but implements <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>. This should improve the compatibility of vctrs-based functions with foreign classes (<a href='https://github.com/r-lib/vctrs/issues/801'>#801</a>).</p></li>
<li><p><code><a href="../reference/new_data_frame.html">new_data_frame()</a></code> is now faster.</p></li>
<li><p>New <code><a href="../reference/vec_is_list.html">vec_is_list()</a></code> for detecting if a vector is a list in the vctrs sense. For instance, objects of class <code>lm</code> are not lists. In general, classes need to explicitly inherit from <code>"list"</code> to be considered as lists by vctrs.</p></li>
<li>
<p>Unspecified vectors of <code>NA</code> can now be assigned into a list (<a href='https://github.com/r-lib/vctrs/issues/819'>#819</a>).</p>
<pre><code>x &lt;- list(1, 2)
vec_slice(x, 1) &lt;- NA
x
#&gt; [[1]]
#&gt; NULL
#&gt;
#&gt; [[2]]
#&gt; 2</code></pre>
</li>
<li><p><code><a href="../reference/vec_ptype.html">vec_ptype()</a></code> now errors on scalar inputs (<a href='https://github.com/r-lib/vctrs/issues/807'>#807</a>).</p></li>
<li><p><code><a href="../reference/new_partial.html">vec_ptype_finalise()</a></code> is now recursive over all data frame types, ensuring that unspecified columns are correctly finalised to logical (<a href='https://github.com/r-lib/vctrs/issues/800'>#800</a>).</p></li>
<li><p><code><a href="../reference/vec_ptype.html">vec_ptype()</a></code> now correctly handles unspecified columns in data frames, and will always return an unspecified column type (<a href='https://github.com/r-lib/vctrs/issues/800'>#800</a>).</p></li>
<li><p><code><a href="../reference/vec_slice.html">vec_slice()</a></code> and <code><a href="../reference/vec_chop.html">vec_chop()</a></code> now work correctly with <code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html">bit64::integer64()</a></code> objects when an <code>NA</code> subscript is supplied. By extension, this means that <code><a href="../reference/vec_init.html">vec_init()</a></code> now works with these objects as well (<a href='https://github.com/r-lib/vctrs/issues/813'>#813</a>).</p></li>
<li><p><code><a href="../reference/vec_bind.html">vec_rbind()</a></code> now binds row names. When named inputs are supplied and <code>names_to</code> is <code>NULL</code>, the names define row names. If <code>names_to</code> is supplied, they are assigned in the column name as before.</p></li>
<li><p><code><a href="../reference/vec_bind.html">vec_cbind()</a></code> now uses the row names of the first named input.</p></li>
<li><p>The <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> method for <code>vctrs_vctr</code> now throws an error when <code>recursive</code> or <code>use.names</code> is supplied (<a href='https://github.com/r-lib/vctrs/issues/791'>#791</a>).</p></li>
</ul>
</div>
    <div id="vctrs-022" class="section level1">
<h1 class="page-header" data-toc-text="0.2.2">
<a href="#vctrs-022" class="anchor"></a>vctrs 0.2.2<small> 2020-01-24 </small>
</h1>
<ul>
<li><p>New <code><a href="../reference/vec_as_subscript.html">vec_as_subscript()</a></code> function to cast inputs to the base type of a subscript (logical, numeric, or character). <code><a href="../reference/vec_as_index.html">vec_as_index()</a></code> has been renamed to <code><a href="../reference/vec_as_location.html">vec_as_location()</a></code>. Use <code><a href="../reference/vec_as_location.html">num_as_location()</a></code> if you need more options to control how numeric subscripts are converted to a vector of locations.</p></li>
<li><p>New <code><a href="../reference/vec_as_subscript.html">vec_as_subscript2()</a></code>, <code><a href="../reference/vec_as_location.html">vec_as_location2()</a></code>, and <code><a href="../reference/vec_as_location.html">num_as_location2()</a></code> variants for validating scalar subscripts and locations (e.g. for indexing with <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code>).</p></li>
<li><p><code><a href="../reference/vec_as_location.html">vec_as_location()</a></code> now preserves names of its inputs if possible.</p></li>
<li>
<p><code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> methods for base classes now prevent inheritance. This makes sense because the subtyping graph created by <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> methods is generally not the same as the inheritance relationships defined by S3 classes. For instance, subclasses are often a richer type than their superclasses, and should often be declared as supertypes (e.g. <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> should return the subclass).</p>
<p>We introduced this breaking change in a patch release because <code><a href="../reference/new_vctr.html">new_vctr()</a></code> now adds the base type to the class vector by default, which caused <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> to dispatch erroneously to the methods for base types. We’ll finish switching to this approach in vctrs 0.3.0 for the rest of the base S3 classes (dates, data frames, …).</p>
</li>
<li><p><code><a href="../reference/vec_equal.html">vec_equal_na()</a></code> now works with complex vectors.</p></li>
<li><p><code>vctrs_vctr</code> class gains an <code><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt()</a></code> method (<a href='https://github.com/r-lib/vctrs/issues/717'>#717</a>).</p></li>
<li><p><code><a href="../reference/vec_assert.html">vec_is()</a></code> now ignores names and row names (<a href='https://github.com/r-lib/vctrs/issues/707'>#707</a>).</p></li>
<li><p><code><a href="../reference/vec_slice.html">vec_slice()</a></code> now support Altvec vectors (<a href='https://github.com/jimhester'>@jimhester</a>, <a href='https://github.com/r-lib/vctrs/issues/696'>#696</a>).</p></li>
<li><p><code><a href="../reference/vec_proxy_equal.html">vec_proxy_equal()</a></code> is now applied recursively across the columns of data frames (<a href='https://github.com/r-lib/vctrs/issues/641'>#641</a>).</p></li>
<li><p><code><a href="../reference/vec_split.html">vec_split()</a></code> no longer returns the <code>val</code> column as a <code>list_of</code>. It is now returned as a bare list (<a href='https://github.com/r-lib/vctrs/issues/660'>#660</a>).</p></li>
<li><p>Complex numbers are now coercible with integer and double (<a href='https://github.com/r-lib/vctrs/issues/564'>#564</a>).</p></li>
<li><p>zeallot has been moved from Imports to Suggests, meaning that <code><a href="https://rdrr.io/pkg/zeallot/man/operator.html">%&lt;-%</a></code> is no longer re-exported from vctrs.</p></li>
<li><p><code><a href="../reference/vec_equal.html">vec_equal()</a></code> no longer propagates missing values when comparing list elements. This means that <code><a href="../reference/vec_equal.html">vec_equal(list(NULL), list(NULL))</a></code> will continue to return <code>NA</code> because <code>NULL</code> is the missing element for a list, but now <code><a href="../reference/vec_equal.html">vec_equal(list(NA), list(NA))</a></code> returns <code>TRUE</code> because the <code>NA</code> values are compared directly without checking for missingness.</p></li>
<li><p>Lists of expressions are now supported in <code><a href="../reference/vec_equal.html">vec_equal()</a></code> and functions that compare elements, such as <code><a href="../reference/vec_unique.html">vec_unique()</a></code> and <code><a href="../reference/vec_match.html">vec_match()</a></code>. This ensures that they work with the result of modeling functions like <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> and <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html">mgcv::gam()</a></code> which store “family” objects containing expressions (<a href='https://github.com/r-lib/vctrs/issues/643'>#643</a>).</p></li>
<li><p><code><a href="../reference/new_vctr.html">new_vctr()</a></code> gains an experimental <code>inherit_base_type</code> argument which determines whether or not the class of the underlying type will be included in the class.</p></li>
<li><p><code><a href="../reference/list_of.html">list_of()</a></code> now inherits explicitly from “list” (<a href='https://github.com/r-lib/vctrs/issues/593'>#593</a>).</p></li>
<li><p><code><a href="../reference/vec_ptype.html">vec_ptype()</a></code> has relaxed default behaviour for base types; now if two vectors both inherit from (e.g.) “character”, the common type is also “character” (<a href='https://github.com/r-lib/vctrs/issues/497'>#497</a>).</p></li>
<li><p><code><a href="../reference/vec_equal.html">vec_equal()</a></code> now correctly treats <code>NULL</code> as the missing value element for lists (<a href='https://github.com/r-lib/vctrs/issues/653'>#653</a>).</p></li>
<li><p><code><a href="../reference/vec_cast.html">vec_cast()</a></code> now casts data frames to lists rowwise, i.e. to a list of data frames of size 1. This preserves the invariant of <code>vec_size(vec_cast(x, to)) == vec_size(x)</code> (<a href='https://github.com/r-lib/vctrs/issues/639'>#639</a>).</p></li>
<li><p>Positive and negative 0 are now considered equivalent by all functions that check for equality or uniqueness (<a href='https://github.com/r-lib/vctrs/issues/637'>#637</a>).</p></li>
<li><p>New experimental functions <code><a href="../reference/vec_group.html">vec_group_rle()</a></code> for returning run length encoded groups; <code><a href="../reference/vec_group.html">vec_group_id()</a></code> for constructing group identifiers from a vector; <code><a href="../reference/vec_group.html">vec_group_loc()</a></code> for computing the locations of unique groups in a vector (<a href='https://github.com/r-lib/vctrs/issues/514'>#514</a>).</p></li>
<li><p>New <code><a href="../reference/vec_chop.html">vec_chop()</a></code> for repeatedly slicing a vector. It efficiently captures the pattern of <code>map(indices, vec_slice, x = x)</code>.</p></li>
<li><p>Support for multiple character encodings has been added to functions that compare elements within a single vector, such as <code><a href="../reference/vec_unique.html">vec_unique()</a></code>, and across multiple vectors, such as <code><a href="../reference/vec_match.html">vec_match()</a></code>. When multiple encodings are encountered, a translation to UTF-8 is performed before any comparisons are made (<a href='https://github.com/r-lib/vctrs/issues/600'>#600</a>, <a href='https://github.com/r-lib/vctrs/issues/553'>#553</a>).</p></li>
<li><p>Equality and ordering methods are now implemented for raw and complex vectors (<a href='https://github.com/romainfrancois'>@romainfrancois</a>).</p></li>
</ul>
</div>
    <div id="vctrs-021" class="section level1">
<h1 class="page-header" data-toc-text="0.2.1">
<a href="#vctrs-021" class="anchor"></a>vctrs 0.2.1<small> 2019-12-17 </small>
</h1>
<p>Maintenance release for CRAN checks.</p>
</div>
    <div id="vctrs-020" class="section level1">
<h1 class="page-header" data-toc-text="0.2.0">
<a href="#vctrs-020" class="anchor"></a>vctrs 0.2.0<small> 2019-07-05 </small>
</h1>
<p>With the 0.2.0 release, many vctrs functions have been rewritten with native C code to improve performance. Functions like <code><a href="../reference/vec_c.html">vec_c()</a></code> and <code><a href="../reference/vec_bind.html">vec_rbind()</a></code> should now be fast enough to be used in packages. This is an ongoing effort, for instance the handling of factors and dates has not been rewritten yet. These classes still slow down vctrs primitives.</p>
<p>The API in 0.2.0 has been updated, please see a list of breaking changes below. vctrs has now graduated from experimental to a maturing package (see the <a href="https://www.tidyverse.org/lifecycle/">lifecycle of tidyverse packages</a>). Please note that API changes are still planned for future releases, for instance <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code> and <code><a href="../reference/vec_cast.html">vec_cast()</a></code> might need to return a sentinel instead of failing with an error when there is no common type or possible cast.</p>
<div id="breaking-changes-1" class="section level2">
<h2 class="hasAnchor">
<a href="#breaking-changes-1" class="anchor"></a>Breaking changes</h2>
<ul>
<li><p>Lossy casts now throw errors of type <code>vctrs_error_cast_lossy</code>. Previously these were warnings. You can suppress these errors selectively with <code><a href="../reference/vctrs-conditions.html">allow_lossy_cast()</a></code> to get the partial cast results. To implement your own lossy cast operation, call the new exported function <code><a href="../reference/maybe_lossy_cast.html">maybe_lossy_cast()</a></code>.</p></li>
<li>
<p><code><a href="../reference/vec_c.html">vec_c()</a></code> now fails when an input is supplied with a name but has internal names or is length &gt; 1:</p>
<pre><code><a href="../reference/vec_c.html">vec_c(foo = c(a = 1))
#&gt; Error: Can't merge the outer name `foo` with a named vector.
#&gt; Please supply a `.name_spec` specification.

vec_c(foo = 1:3)
#&gt; Error: Can't merge the outer name `foo` with a vector of length &gt; 1.
#&gt; Please supply a `.name_spec` specification.</a></code></pre>
<p>You can supply a name specification that describes how to combine the external name of the input with its internal names or positions:</p>
<pre><code><a href="../reference/vec_c.html"># Name spec as glue string:
vec_c(foo = c(a = 1), .name_spec = "{outer}_{inner}")

# Name spec as a function:
vec_c(foo = c(a = 1), .name_spec = function(outer, inner) paste(outer, inner, sep = "_"))
vec_c(foo = c(a = 1), .name_spec = ~ paste(.x, .y, sep = "_"))</a></code></pre>
</li>
<li><p><code><a href="../reference/vec_empty.html">vec_empty()</a></code> has been renamed to <code><a href="../reference/vec_size.html">vec_is_empty()</a></code>.</p></li>
<li><p><code>vec_dim()</code> and <code>vec_dims()</code> are no longer exported.</p></li>
<li><p><code>vec_na()</code> has been renamed to <code><a href="../reference/vec_init.html">vec_init()</a></code>, as the primary use case is to initialize an output container.</p></li>
<li><p><code>vec_slice&lt;-</code> is now type stable (<a href='https://github.com/r-lib/vctrs/issues/140'>#140</a>). It always returns the same type as the LHS. If needed, the RHS is cast to the correct type, but only if both inputs are coercible. See examples in <code><a href="../reference/vec_slice.html">?vec_slice</a></code>.</p></li>
<li>
<p>We have renamed the <code>type</code> particle to <code>ptype</code>:</p>
<ul>
<li>
<code><a href="../reference/vec_type.html">vec_type()</a></code> =&gt; <code><a href="../reference/vec_ptype.html">vec_ptype()</a></code>
</li>
<li>
<code><a href="../reference/vec_type.html">vec_type2()</a></code> =&gt; <code><a href="../reference/vec_ptype2.logical.html">vec_ptype2()</a></code>
</li>
<li>
<code><a href="../reference/vec_type.html">vec_type_common()</a></code> =&gt; <code><a href="../reference/vec_ptype.html">vec_ptype_common()</a></code>
</li>
</ul>
<p>Consequently, <code><a href="../reference/vec_ptype.html">vec_ptype()</a></code> was renamed to <code><a href="../reference/vec_ptype.html">vec_ptype_show()</a></code>.</p>
</li>
</ul>
</div>
<div id="new-features" class="section level2">
<h2 class="hasAnchor">
<a href="#new-features" class="anchor"></a>New features</h2>
<ul>
<li>
<p>New <code><a href="../reference/vec_proxy.html">vec_proxy()</a></code> generic. This is the main customisation point in vctrs along with <code><a href="../reference/vec_proxy.html">vec_restore()</a></code>. You should only implement it when your type is designed around a non-vector class (atomic vectors, bare lists, data frames). In this case, <code><a href="../reference/vec_proxy.html">vec_proxy()</a></code> should return such a vector class. The vctrs operations will be applied on the proxy and <code><a href="../reference/vec_proxy.html">vec_restore()</a></code> is called to restore the original representation of your type.</p>
<p>The most common case where you need to implement <code><a href="../reference/vec_proxy.html">vec_proxy()</a></code> is for S3 lists. In vctrs, S3 lists are treated as scalars by default. This way we don’t treat objects like model fits as vectors. To prevent vctrs from treating your S3 list as a scalar, unclass it from the <code><a href="../reference/vec_proxy.html">vec_proxy()</a></code> method. For instance here is the definition for <code>list_of</code>:</p>
<pre><code>#' <a href='https://github.com/export'>@export</a>
vec_proxy.vctrs_list_of &lt;- function(x) {
  unclass(x)
}</code></pre>
<p>If you inherit from <code>vctrs_vctr</code> or <code>vctrs_rcrd</code> you don’t need to implement <code><a href="../reference/vec_proxy.html">vec_proxy()</a></code>.</p>
</li>
<li><p><code><a href="../reference/vec_c.html">vec_c()</a></code>, <code><a href="../reference/vec_bind.html">vec_rbind()</a></code>, and <code><a href="../reference/vec_bind.html">vec_cbind()</a></code> gain a <code>.name_repair</code> argument (<a href='https://github.com/r-lib/vctrs/issues/227'>#227</a>, <a href='https://github.com/r-lib/vctrs/issues/229'>#229</a>).</p></li>
<li>
<p><code><a href="../reference/vec_c.html">vec_c()</a></code>, <code><a href="../reference/vec_bind.html">vec_rbind()</a></code>, <code><a href="../reference/vec_bind.html">vec_cbind()</a></code>, and all functions relying on <code><a href="../reference/vec_ptype.html">vec_ptype_common()</a></code> now have more informative error messages when some of the inputs have nested data frames that are not convergent:</p>
<pre><code>df1 &lt;- tibble(foo = tibble(bar = tibble(x = 1:3, y = letters[1:3])))
df2 &lt;- tibble(foo = tibble(bar = tibble(x = 1:3, y = 4:6)))

vec_rbind(df1, df2)
#&gt; Error: No common type for `..1$foo$bar$y` &lt;character&gt; and `..2$foo$bar$y` &lt;integer&gt;.</code></pre>
</li>
<li>
<p><code><a href="../reference/vec_bind.html">vec_cbind()</a></code> now turns named data frames to packed columns.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>data &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">y =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</span>
<span id="cb7-2"><a href="#cb7-2"></a>data &lt;-<span class="st"> </span><span class="kw">vec_cbind</span>(data, <span class="dt">packed =</span> data)</span>
<span id="cb7-3"><a href="#cb7-3"></a>data</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># A tibble: 3 x 3</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>      x y     packed<span class="op">$</span>x <span class="op">$</span>y</span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">    </span><span class="er">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="dv">1</span>     <span class="dv">1</span> a            <span class="dv">1</span> a</span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="dv">2</span>     <span class="dv">2</span> b            <span class="dv">2</span> b</span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="dv">3</span>     <span class="dv">3</span> c            <span class="dv">3</span> c</span></code></pre></div>
<p>Packed data frames are nested in a single column. This makes it possible to access it through a single name:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>data<span class="op">$</span>packed</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co"># A tibble: 3 x 2</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>      x y</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="dv">1</span>     <span class="dv">1</span> a</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="dv">2</span>     <span class="dv">2</span> b</span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="dv">3</span>     <span class="dv">3</span> c</span></code></pre></div>
<p>We are planning to use this syntax more widely in the tidyverse.</p>
</li>
<li>
<p>New <code><a href="../reference/vec_assert.html">vec_is()</a></code> function to check whether a vector conforms to a prototype and/or a size. Unlike <code><a href="../reference/vec_assert.html">vec_assert()</a></code>, it doesn’t throw errors but returns <code>TRUE</code> or <code>FALSE</code> (<a href='https://github.com/r-lib/vctrs/issues/79'>#79</a>).</p>
<p>Called without a specific type or size, <code><a href="../reference/vec_assert.html">vec_assert()</a></code> tests whether an object is a data vector or a scalar. S3 lists are treated as scalars by default. Implement a <code>vec_is_vector()</code> for your class to override this property (or derive from <code>vctrs_vctr</code>).</p>
</li>
<li><p>New <code><a href="../reference/vec_order.html">vec_order()</a></code> and <code><a href="../reference/vec_order.html">vec_sort()</a></code> for ordering and sorting generalised vectors.</p></li>
<li><p>New <code>.names_to</code> parameter for <code><a href="../reference/vec_bind.html">vec_rbind()</a></code>. If supplied, this should be the name of a column where the names of the inputs are copied. This is similar to the <code>.id</code> parameter of <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_rows()</a></code>.</p></li>
<li><p>New <code><a href="../reference/vec_seq_along.html">vec_seq_along()</a></code> and <code><a href="../reference/vec_seq_along.html">vec_init_along()</a></code> create useful sequences (<a href='https://github.com/r-lib/vctrs/issues/189'>#189</a>).</p></li>
<li><p><code><a href="../reference/vec_slice.html">vec_slice()</a></code> now preserves character row names, if present.</p></li>
<li><p>New <code><a href="../reference/vec_split.html">vec_split(x, by)</a></code> is a generalisation of <code><a href="https://rdrr.io/r/base/split.html">split()</a></code> that can divide a vector into groups formed by the unique values of another vector. Returns a two-column data frame containing unique values of <code>by</code> aligned with matching <code>x</code> values (<a href='https://github.com/r-lib/vctrs/issues/196'>#196</a>).</p></li>
</ul>
</div>
<div id="other-features-and-bug-fixes" class="section level2">
<h2 class="hasAnchor">
<a href="#other-features-and-bug-fixes" class="anchor"></a>Other features and bug fixes</h2>
<ul>
<li><p>Using classed errors of class <code>"vctrs_error_assert"</code> for failed assertions, and of class <code>"vctrs_error_incompatible"</code> (with subclasses <code>_type</code>, <code>_cast</code> and <code>_op</code>) for errors on incompatible types (<a href='https://github.com/r-lib/vctrs/issues/184'>#184</a>).</p></li>
<li><p>Character indexing is now only supported for named objects, an error is raised for unnamed objects (<a href='https://github.com/r-lib/vctrs/issues/171'>#171</a>).</p></li>
<li><p>Predicate generics now consistently return logical vectors when passed a <code>vctrs_vctr</code> class. They used to restore the output to their input type (<a href='https://github.com/r-lib/vctrs/issues/251'>#251</a>).</p></li>
<li><p><code><a href="../reference/list_of.html">list_of()</a></code> now has an <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> method. It uses <code><a href="../reference/vec_ptype_full.html">vec_ptype_abbr()</a></code> to collapse complex objects into their type representation (tidyverse/tidyr<a href='https://github.com/r-lib/vctrs/issues/654'>#654</a>).</p></li>
<li><p>New <code><a href="../reference/vctrs-conditions.html">stop_incompatible_size()</a></code> to signal a failure due to mismatched sizes.</p></li>
<li><p>New <code><a href="../reference/list_of.html">validate_list_of()</a></code> (<a href='https://github.com/r-lib/vctrs/issues/193'>#193</a>).</p></li>
<li><p><code><a href="../reference/vec_arith.html">vec_arith()</a></code> is consistent with base R when combining <code>difftime</code> and <code>date</code>, with a warning if casts are lossy (<a href='https://github.com/r-lib/vctrs/issues/192'>#192</a>).</p></li>
<li><p><code><a href="../reference/vec_c.html">vec_c()</a></code> and <code><a href="../reference/vec_bind.html">vec_rbind()</a></code> now handle data.frame columns properly (<a href='https://github.com/yutannihilation'>@yutannihilation</a>, <a href='https://github.com/r-lib/vctrs/issues/182'>#182</a>).</p></li>
<li><p><code><a href="../reference/vec_cast.html">vec_cast(x, data.frame())</a></code> preserves the number of rows in <code>x</code>.</p></li>
<li><p><code><a href="../reference/vec_equal.html">vec_equal()</a></code> now handles missing values symmetrically (<a href='https://github.com/r-lib/vctrs/issues/204'>#204</a>).</p></li>
<li><p><code><a href="../reference/vec_equal.html">vec_equal_na()</a></code> now returns <code>TRUE</code> for data frames and records when every component is missing, not when <em>any</em> component is missing (<a href='https://github.com/r-lib/vctrs/issues/201'>#201</a>).</p></li>
<li><p><code><a href="../reference/vec_init.html">vec_init()</a></code> checks input is a vector.</p></li>
<li><p><code><a href="../reference/vec_proxy_compare.html">vec_proxy_compare()</a></code> gains an experimental <code>relax</code> argument, which allows data frames to be orderable even if all their columns are not (<a href='https://github.com/r-lib/vctrs/issues/210'>#210</a>).</p></li>
<li><p><code><a href="../reference/vec_size.html">vec_size()</a></code> now works with positive short row names. This fixes issues with data frames created with jsonlite (<a href='https://github.com/r-lib/vctrs/issues/220'>#220</a>).</p></li>
<li><p><code>vec_slice&lt;-</code> now has a <code><a href="../reference/vec_slice.html">vec_assign()</a></code> alias. Use <code><a href="../reference/vec_slice.html">vec_assign()</a></code> when you don’t want to modify the original input.</p></li>
<li><p><code><a href="../reference/vec_slice.html">vec_slice()</a></code> now calls <code><a href="../reference/vec_proxy.html">vec_restore()</a></code> automatically. Unlike the default <code><a href="https://rdrr.io/r/base/Extract.html">[</a></code> method from base R, attributes are preserved by default.</p></li>
<li><p><code><a href="../reference/vec_slice.html">vec_slice()</a></code> can correct slice 0-row data frames (<a href='https://github.com/r-lib/vctrs/issues/179'>#179</a>).</p></li>
<li><p>New <code><a href="../reference/vec_repeat.html">vec_repeat()</a></code> for repeating each element of a vector the same number of times.</p></li>
<li><p><code><a href="../reference/vec_type.html">vec_type2(x, data.frame())</a></code> ensures that the returned object has names that are a length-0 character vector.</p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, Lionel Henry, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


