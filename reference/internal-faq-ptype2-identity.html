<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Internal FAQ - <code>vec_ptype2()</code>, <code>NULL</code>, and unspecified vectors — internal-faq-ptype2-identity • vctrs</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Internal FAQ - <code>vec_ptype2()</code>, <code>NULL</code>, and unspecified vectors — internal-faq-ptype2-identity" />
<meta property="og:description" content="
Promotion monoid


Promotions (i.e. automatic coercions) should always transform inputs to
their richer type to avoid losing values of precision. vec_ptype2()
returns the richer type of two vectors, or throws an incompatible type
error if none of the two vector types include the other. For example,
the richer type of integer and double is the latter because double
covers a larger range of values than integer.
vec_ptype2() is a monoid over
vectors, which in practical terms means that it is a well behaved
operation for
reduction.
Reduction is an important operation for promotions because that is how
the richer type of multiple elements is computed. As a monoid,
vec_ptype2() needs an identity element, i.e. a value that doesn’t
change the result of the reduction. vctrs has two identity values,
NULL and unspecified vectors.

The NULL identity


As an identity element that shouldn’t influence the determination of the
common type of a set of vectors, NULL is promoted to any type:vec_ptype2(NULL, &quot;&quot;)
#&amp;amp;gt; character(0)
vec_ptype2(1L, NULL)
#&amp;amp;gt; integer(0)
The common type of NULL and NULL is the identity NULL:vec_ptype2(NULL, NULL)
#&amp;amp;gt; NULL
This way the result of vec_ptype2(NULL, NULL) does not influence
subsequent promotions:vec_ptype2(
  vec_ptype2(NULL, NULL),
  &quot;&quot;
)
#&amp;amp;gt; character(0)

Unspecified vectors


In the vctrs coercion system, logical vectors of missing values are also
automatically promoted to the type of any other vector, just like
NULL. We call these vectors unspecified. The special coercion
semantics of unspecified vectors serve two purposes:
It makes it possible to assign vectors of NA inside any type of
vectors, even when they are not coercible with logical:x &amp;amp;lt;- letters[1:5]
vec_assign(x, 1:2, c(NA, NA))
#&amp;amp;gt; [1] NA  NA  &quot;c&quot; &quot;d&quot; &quot;e&quot;
We can’t put NULL in a data frame, so we need an identity element
that behaves more like a vector. Logical vectors of NA seem a
natural fit for this.


Unspecified vectors are thus promoted to any other type, just like
NULL:vec_ptype2(NA, &quot;&quot;)
#&amp;amp;gt; character(0)
vec_ptype2(1L, c(NA, NA))
#&amp;amp;gt; integer(0)

Finalising common types


vctrs has an internal vector type of class vctrs_unspecified. Users
normally don’t see such vectors in the wild, but they do come up when
taking the common type of an unspecified vector with another identity
value:vec_ptype2(NA, NA)
#&amp;amp;gt; &amp;amp;lt;unspecified&amp;amp;gt; [0]
vec_ptype2(NA, NULL)
#&amp;amp;gt; &amp;amp;lt;unspecified&amp;amp;gt; [0]
vec_ptype2(NULL, NA)
#&amp;amp;gt; &amp;amp;lt;unspecified&amp;amp;gt; [0]
We can’t return NA here because vec_ptype2() normally returns empty
vectors. We also can’t return NULL because unspecified vectors need to
be recognised as logical vectors if they haven’t been promoted at the
end of the reduction.vec_ptype_finalise(vec_ptype2(NULL, NA))
#&amp;amp;gt; logical(0)
See the output of vec_ptype_common() which performs the reduction and
finalises the type, ready to be used by the caller:vec_ptype_common(NULL, NULL)
#&amp;amp;gt; NULL
vec_ptype_common(NA, NULL)
#&amp;amp;gt; logical(0)
Note that partial types in vctrs make use of the same mechanism.
They are finalised with vec_ptype_finalise().
" />
<meta property="og:image" content="https://vctrs.r-lib.org/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vctrs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/pillar.html">Printing vectors nicely in tibbles</a>
    </li>
    <li>
      <a href="../articles/s3-vector.html">S3 vectors</a>
    </li>
    <li>
      <a href="../articles/stability.html">Type and size stability</a>
    </li>
    <li>
      <a href="../articles/type-size.html">Prototypes and sizes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/vctrs/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Internal FAQ - <code>vec_ptype2()</code>, <code>NULL</code>, and unspecified vectors</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/vctrs/blob/master/R/faq-internal.R'><code>R/faq-internal.R</code></a></small>
    <div class="hidden name"><code>internal-faq-ptype2-identity.Rd</code></div>
    </div>

    <div class="ref-description">
    
<h3>Promotion monoid</h3>


<p>Promotions (i.e. automatic coercions) should always transform inputs to
their richer type to avoid losing values of precision. <code><a href='vec_ptype2.html'>vec_ptype2()</a></code>
returns the <em>richer</em> type of two vectors, or throws an incompatible type
error if none of the two vector types include the other. For example,
the richer type of integer and double is the latter because double
covers a larger range of values than integer.</p>
<p><code><a href='vec_ptype2.html'>vec_ptype2()</a></code> is a <a href='https://en.wikipedia.org/wiki/Monoid'>monoid</a> over
vectors, which in practical terms means that it is a well behaved
operation for
<a href='https://purrr.tidyverse.org/reference/reduce.html'>reduction</a>.
Reduction is an important operation for promotions because that is how
the richer type of multiple elements is computed. As a monoid,
<code><a href='vec_ptype2.html'>vec_ptype2()</a></code> needs an identity element, i.e. a value that doesn’t
change the result of the reduction. vctrs has two identity values,
<code>NULL</code> and <strong>unspecified</strong> vectors.</p>

<h3>The <code>NULL</code> identity</h3>


<p>As an identity element that shouldn’t influence the determination of the
common type of a set of vectors, <code>NULL</code> is promoted to any type:<div class="r"></p><pre><span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(<span class='kw'>NULL</span>, <span class='st'>""</span>)
<span class='co'>#&amp;gt; character(0)</span>
<span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(<span class='fl'>1L</span>, <span class='kw'>NULL</span>)
<span class='co'>#&amp;gt; integer(0)</span></pre><p></div></p>
<p>The common type of <code>NULL</code> and <code>NULL</code> is the identity <code>NULL</code>:<div class="r"></p><pre><span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(<span class='kw'>NULL</span>, <span class='kw'>NULL</span>)
<span class='co'>#&amp;gt; NULL</span></pre><p></div></p>
<p>This way the result of <code><a href='vec_ptype2.html'>vec_ptype2(NULL, NULL)</a></code> does not influence
subsequent promotions:<div class="r"></p><pre><span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(
  <span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(<span class='kw'>NULL</span>, <span class='kw'>NULL</span>),
  <span class='st'>""</span>
)
<span class='co'>#&amp;gt; character(0)</span></pre><p></div></p>

<h3>Unspecified vectors</h3>


<p>In the vctrs coercion system, logical vectors of missing values are also
automatically promoted to the type of any other vector, just like
<code>NULL</code>. We call these vectors unspecified. The special coercion
semantics of unspecified vectors serve two purposes:</p><ol>
<li><p>It makes it possible to assign vectors of <code>NA</code> inside any type of
vectors, even when they are not coercible with logical:<div class="r"></p><pre><span class='no'>x</span> <span class='kw'>&amp;</span><span class='no'>lt</span>;- <span class='no'>letters</span>[<span class='fl'>1</span>:<span class='fl'>5</span>]
<span class='fu'><a href='vec_slice.html'>vec_assign</a></span>(<span class='no'>x</span>, <span class='fl'>1</span>:<span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>NA</span>, <span class='fl'>NA</span>))
<span class='co'>#&amp;gt; [1] NA  NA  "c" "d" "e"</span></pre><p></div></p></li>
<li><p>We can’t put <code>NULL</code> in a data frame, so we need an identity element
that behaves more like a vector. Logical vectors of <code>NA</code> seem a
natural fit for this.</p></li>
</ol>

<p>Unspecified vectors are thus promoted to any other type, just like
<code>NULL</code>:<div class="r"></p><pre><span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(<span class='fl'>NA</span>, <span class='st'>""</span>)
<span class='co'>#&amp;gt; character(0)</span>
<span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(<span class='fl'>1L</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>NA</span>, <span class='fl'>NA</span>))
<span class='co'>#&amp;gt; integer(0)</span></pre><p></div></p>

<h3>Finalising common types</h3>


<p>vctrs has an internal vector type of class <code>vctrs_unspecified</code>. Users
normally don’t see such vectors in the wild, but they do come up when
taking the common type of an unspecified vector with another identity
value:<div class="r"></p><pre><span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(<span class='fl'>NA</span>, <span class='fl'>NA</span>)
<span class='co'>#&amp;gt; &amp;lt;unspecified&amp;gt; [0]</span>
<span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(<span class='fl'>NA</span>, <span class='kw'>NULL</span>)
<span class='co'>#&amp;gt; &amp;lt;unspecified&amp;gt; [0]</span>
<span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(<span class='kw'>NULL</span>, <span class='fl'>NA</span>)
<span class='co'>#&amp;gt; &amp;lt;unspecified&amp;gt; [0]</span></pre><p></div></p>
<p>We can’t return <code>NA</code> here because <code><a href='vec_ptype2.html'>vec_ptype2()</a></code> normally returns empty
vectors. We also can’t return <code>NULL</code> because unspecified vectors need to
be recognised as logical vectors if they haven’t been promoted at the
end of the reduction.<div class="r"></p><pre><span class='fu'><a href='new_partial.html'>vec_ptype_finalise</a></span>(<span class='fu'><a href='vec_ptype2.html'>vec_ptype2</a></span>(<span class='kw'>NULL</span>, <span class='fl'>NA</span>))
<span class='co'>#&amp;gt; logical(0)</span></pre><p></div></p>
<p>See the output of <code><a href='vec_ptype.html'>vec_ptype_common()</a></code> which performs the reduction and
finalises the type, ready to be used by the caller:<div class="r"></p><pre><span class='fu'><a href='vec_ptype.html'>vec_ptype_common</a></span>(<span class='kw'>NULL</span>, <span class='kw'>NULL</span>)
<span class='co'>#&amp;gt; NULL</span>
<span class='fu'><a href='vec_ptype.html'>vec_ptype_common</a></span>(<span class='fl'>NA</span>, <span class='kw'>NULL</span>)
<span class='co'>#&amp;gt; logical(0)</span></pre><p></div></p>
<p>Note that <strong>partial</strong> types in vctrs make use of the same mechanism.
They are finalised with <code><a href='new_partial.html'>vec_ptype_finalise()</a></code>.</p>

    </div>




  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, Lionel Henry, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


