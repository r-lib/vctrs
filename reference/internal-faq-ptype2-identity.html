<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='

Promotion monoid


Promotions (i.e. automatic coercions) should always transform inputs to
their richer type to avoid losing values of precision. vec_ptype2()
returns the richer type of two vectors, or throws an incompatible type
error if none of the two vector types include the other. For example,
the richer type of integer and double is the latter because double
covers a larger range of values than integer.
vec_ptype2() is a monoid over
vectors, which in practical terms means that it is a well behaved
operation for
reduction.
Reduction is an important operation for promotions because that is how
the richer type of multiple elements is computed. As a monoid,
vec_ptype2() needs an identity element, i.e. a value that doesn’t
change the result of the reduction. vctrs has two identity values,
NULL and unspecified vectors.



The NULL identity


As an identity element that shouldn’t influence the determination of the
common type of a set of vectors, NULL is promoted to any type:
vec_ptype2(NULL, "")
#&amp;gt; character(0)
vec_ptype2(1L, NULL)
#&amp;gt; integer(0)

The common type of NULL and NULL is the identity NULL:
vec_ptype2(NULL, NULL)
#&amp;gt; NULL

This way the result of vec_ptype2(NULL, NULL) does not influence
subsequent promotions:
vec_ptype2(
  vec_ptype2(NULL, NULL),
  ""
)
#&amp;gt; character(0)




Unspecified vectors


In the vctrs coercion system, logical vectors of missing values are also
automatically promoted to the type of any other vector, just like
NULL. We call these vectors unspecified. The special coercion
semantics of unspecified vectors serve two purposes:
It makes it possible to assign vectors of NA inside any type of
vectors, even when they are not coercible with logical:
x &amp;lt;- letters[1:5]
vec_assign(x, 1:2, c(NA, NA))
#&amp;gt; [1] NA  NA  "c" "d" "e"

We can’t put NULL in a data frame, so we need an identity element
that behaves more like a vector. Logical vectors of NA seem a
natural fit for this.


Unspecified vectors are thus promoted to any other type, just like
NULL:
vec_ptype2(NA, "")
#&amp;gt; character(0)
vec_ptype2(1L, c(NA, NA))
#&amp;gt; integer(0)




Finalising common types


vctrs has an internal vector type of class vctrs_unspecified. Users
normally don’t see such vectors in the wild, but they do come up when
taking the common type of an unspecified vector with another identity
value:
vec_ptype2(NA, NA)
#&amp;gt; &amp;lt;unspecified&amp;gt; [0]
vec_ptype2(NA, NULL)
#&amp;gt; &amp;lt;unspecified&amp;gt; [0]
vec_ptype2(NULL, NA)
#&amp;gt; &amp;lt;unspecified&amp;gt; [0]

We can’t return NA here because vec_ptype2() normally returns empty
vectors. We also can’t return NULL because unspecified vectors need to
be recognised as logical vectors if they haven’t been promoted at the
end of the reduction.
vec_ptype_finalise(vec_ptype2(NULL, NA))
#&amp;gt; logical(0)

See the output of vec_ptype_common() which performs the reduction and
finalises the type, ready to be used by the caller:
vec_ptype_common(NULL, NULL)
#&amp;gt; NULL
vec_ptype_common(NA, NULL)
#&amp;gt; logical(0)

Note that partial types in vctrs make use of the same mechanism.
They are finalised with vec_ptype_finalise().

'><title>Internal FAQ - vec_ptype2(), NULL, and unspecified vectors — internal-faq-ptype2-identity • vctrs</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.5/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.5/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Internal FAQ - vec_ptype2(), NULL, and unspecified vectors — internal-faq-ptype2-identity"><meta property="og:description" content='

Promotion monoid


Promotions (i.e. automatic coercions) should always transform inputs to
their richer type to avoid losing values of precision. vec_ptype2()
returns the richer type of two vectors, or throws an incompatible type
error if none of the two vector types include the other. For example,
the richer type of integer and double is the latter because double
covers a larger range of values than integer.
vec_ptype2() is a monoid over
vectors, which in practical terms means that it is a well behaved
operation for
reduction.
Reduction is an important operation for promotions because that is how
the richer type of multiple elements is computed. As a monoid,
vec_ptype2() needs an identity element, i.e. a value that doesn’t
change the result of the reduction. vctrs has two identity values,
NULL and unspecified vectors.



The NULL identity


As an identity element that shouldn’t influence the determination of the
common type of a set of vectors, NULL is promoted to any type:
vec_ptype2(NULL, "")
#&amp;gt; character(0)
vec_ptype2(1L, NULL)
#&amp;gt; integer(0)

The common type of NULL and NULL is the identity NULL:
vec_ptype2(NULL, NULL)
#&amp;gt; NULL

This way the result of vec_ptype2(NULL, NULL) does not influence
subsequent promotions:
vec_ptype2(
  vec_ptype2(NULL, NULL),
  ""
)
#&amp;gt; character(0)




Unspecified vectors


In the vctrs coercion system, logical vectors of missing values are also
automatically promoted to the type of any other vector, just like
NULL. We call these vectors unspecified. The special coercion
semantics of unspecified vectors serve two purposes:
It makes it possible to assign vectors of NA inside any type of
vectors, even when they are not coercible with logical:
x &amp;lt;- letters[1:5]
vec_assign(x, 1:2, c(NA, NA))
#&amp;gt; [1] NA  NA  "c" "d" "e"

We can’t put NULL in a data frame, so we need an identity element
that behaves more like a vector. Logical vectors of NA seem a
natural fit for this.


Unspecified vectors are thus promoted to any other type, just like
NULL:
vec_ptype2(NA, "")
#&amp;gt; character(0)
vec_ptype2(1L, c(NA, NA))
#&amp;gt; integer(0)




Finalising common types


vctrs has an internal vector type of class vctrs_unspecified. Users
normally don’t see such vectors in the wild, but they do come up when
taking the common type of an unspecified vector with another identity
value:
vec_ptype2(NA, NA)
#&amp;gt; &amp;lt;unspecified&amp;gt; [0]
vec_ptype2(NA, NULL)
#&amp;gt; &amp;lt;unspecified&amp;gt; [0]
vec_ptype2(NULL, NA)
#&amp;gt; &amp;lt;unspecified&amp;gt; [0]

We can’t return NA here because vec_ptype2() normally returns empty
vectors. We also can’t return NULL because unspecified vectors need to
be recognised as logical vectors if they haven’t been promoted at the
end of the reduction.
vec_ptype_finalise(vec_ptype2(NULL, NA))
#&amp;gt; logical(0)

See the output of vec_ptype_common() which performs the reduction and
finalises the type, ready to be used by the caller:
vec_ptype_common(NULL, NULL)
#&amp;gt; NULL
vec_ptype_common(NA, NULL)
#&amp;gt; logical(0)

Note that partial types in vctrs make use of the same mechanism.
They are finalised with vec_ptype_finalise().

'><meta property="og:image" content="https://vctrs.r-lib.org/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="vctrs.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">vctrs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.6.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pillar.html">Printing vectors nicely in tibbles</a>
    <a class="dropdown-item" href="../articles/s3-vector.html">S3 vectors</a>
    <a class="dropdown-item" href="../articles/stability.html">Type and size stability</a>
    <a class="dropdown-item" href="../articles/type-size.html">Prototypes and sizes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/vctrs/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Internal FAQ - <code>vec_ptype2()</code>, <code>NULL</code>, and unspecified vectors</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/vctrs/blob/HEAD/R/faq-internal.R" class="external-link"><code>R/faq-internal.R</code></a></small>
      <div class="d-none name"><code>internal-faq-ptype2-identity.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    
<div class="section">
<h3 id="promotion-monoid">Promotion monoid<a class="anchor" aria-label="anchor" href="#promotion-monoid"></a></h3>


<p>Promotions (i.e. automatic coercions) should always transform inputs to
their richer type to avoid losing values of precision. <code><a href="vec_ptype2.html">vec_ptype2()</a></code>
returns the <em>richer</em> type of two vectors, or throws an incompatible type
error if none of the two vector types include the other. For example,
the richer type of integer and double is the latter because double
covers a larger range of values than integer.</p>
<p><code><a href="vec_ptype2.html">vec_ptype2()</a></code> is a <a href="https://en.wikipedia.org/wiki/Monoid" class="external-link">monoid</a> over
vectors, which in practical terms means that it is a well behaved
operation for
<a href="https://purrr.tidyverse.org/reference/reduce.html" class="external-link">reduction</a>.
Reduction is an important operation for promotions because that is how
the richer type of multiple elements is computed. As a monoid,
<code><a href="vec_ptype2.html">vec_ptype2()</a></code> needs an identity element, i.e. a value that doesn’t
change the result of the reduction. vctrs has two identity values,
<code>NULL</code> and <strong>unspecified</strong> vectors.</p>
</div>

<div class="section">
<h3 id="the-null-identity">The <code>NULL</code> identity<a class="anchor" aria-label="anchor" href="#the-null-identity"></a></h3>


<p>As an identity element that shouldn’t influence the determination of the
common type of a set of vectors, <code>NULL</code> is promoted to any type:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span><span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; integer(0)</span></span></code></pre><p></p></div>
<p>The common type of <code>NULL</code> and <code>NULL</code> is the identity <code>NULL</code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre><p></p></div>
<p>This way the result of <code>vec_ptype2(NULL, NULL)</code> does not influence
subsequent promotions:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  <span class="st">""</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="unspecified-vectors">Unspecified vectors<a class="anchor" aria-label="anchor" href="#unspecified-vectors"></a></h3>


<p>In the vctrs coercion system, logical vectors of missing values are also
automatically promoted to the type of any other vector, just like
<code>NULL</code>. We call these vectors unspecified. The special coercion
semantics of unspecified vectors serve two purposes:</p><ol><li><p>It makes it possible to assign vectors of <code>NA</code> inside any type of
vectors, even when they are not coercible with logical:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/vec_slice.html">vec_assign</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA  NA  "c" "d" "e"</span></span></code></pre><p></p></div></li>
<li><p>We can’t put <code>NULL</code> in a data frame, so we need an identity element
that behaves more like a vector. Logical vectors of <code>NA</code> seem a
natural fit for this.</p></li>
</ol><p>Unspecified vectors are thus promoted to any other type, just like
<code>NULL</code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span><span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; integer(0)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="finalising-common-types">Finalising common types<a class="anchor" aria-label="anchor" href="#finalising-common-types"></a></h3>


<p>vctrs has an internal vector type of class <code>vctrs_unspecified</code>. Users
normally don’t see such vectors in the wild, but they do come up when
taking the common type of an unspecified vector with another identity
value:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;unspecified&gt; [0]</span></span>
<span><span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;unspecified&gt; [0]</span></span>
<span><span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;unspecified&gt; [0]</span></span></code></pre><p></p></div>
<p>We can’t return <code>NA</code> here because <code><a href="vec_ptype2.html">vec_ptype2()</a></code> normally returns empty
vectors. We also can’t return <code>NULL</code> because unspecified vectors need to
be recognised as logical vectors if they haven’t been promoted at the
end of the reduction.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/new_partial.html">vec_ptype_finalise</a></span><span class="op">(</span><span class="fu"><a href="../reference/vec_ptype2.html">vec_ptype2</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; logical(0)</span></span></code></pre><p></p></div>
<p>See the output of <code><a href="vec_ptype.html">vec_ptype_common()</a></code> which performs the reduction and
finalises the type, ready to be used by the caller:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/vec_ptype.html">vec_ptype_common</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu"><a href="../reference/vec_ptype.html">vec_ptype_common</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; logical(0)</span></span></code></pre><p></p></div>
<p>Note that <strong>partial</strong> types in vctrs make use of the same mechanism.
They are finalised with <code><a href="new_partial.html">vec_ptype_finalise()</a></code>.</p>
</div>

    </div>



  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

